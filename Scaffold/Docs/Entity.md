# Entity Development Flow

## Code First

This scaffold prefers Code First development, no edmx

## CRUD

For CRUD models, the development until typescript should be as simple as possible, suppose we want to create CAR model

1. First we create, `Car.cs` which extends `Model`, which have long primary key, we add `Name` and `Speed` properties
```csharp
    public class Car: Model<long>
    {
        public String Name { get; set; }
        public double Speed { get; set; }
    }
```
2. Add that class to a DBSet in the DBContext, suppose you name `DB` as the DB Context 

```csharp
    public class DB : DbContext 
    {
        public DB(): base("DefaultConnection")
        { 
        }
        public virtual IDbSet<Car> Cars { get; set; }
    }
```

3. Generate migration script, and generate table in the database. type `Update-Database` in Package Manager Console

4. Create the CRUD API controller

```csharp
public class CarController : CRUDController<Car, long>
{
    public CarController(DB dbContext): base(dbContext) {}
}
```

Now you will have a API controller with:
- `GetAll()`, to get all cars
- `Get(id)`, to get one car with that id
- `Post(car)`, to create a new car
- `Put(car)`, to update existing car
- `Delete(car)`, and Delete(id) to delete a car

5. Run `Models.tt` custom tool to generate typescripts code. And you magically have Car in your typescript and ready to be used. For example,
- To create a new car from TypeScript:

```javascript
    new Car({Name: "Anu", Speed: 2.5}).Save()
        .done(c => {console.log(" Save Succeed");})
        .fail(() => {console.log("Save failed");});
```
- To fetch all cars:

```javascript
    Cars.GetAll().done(cars => {
        console.log("There is :"+cars.length+" cars");
    });
```
Notice that all methods will return JqueryPromise http://api.jquery.com/Types/#Promise

6. If you need to add a method in controller, it will also autogenerated to typescript. Suppose you want to calculate in the server distance of the car in some second.

```csharp
public class CarController : CRUDController<Car, long>
{
    public CarController(DB dbContext): base(dbContext) {}
    public double GetDistance(Car car, double second)
    {
        return car.Speed * second;
    }
}
```
You can invoke it in typescript too:

```javascript
    car.GetDistance(2).done(distance =>
        console.log("The distance is :"+distance+" meter");
    });
```